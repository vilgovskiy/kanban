(this.webpackJsonpkanban=this.webpackJsonpkanban||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n(1),r=n.n(s),c=n(19),o=n.n(c),i=(n(26),n(27),n(2)),d=n(3),l=n(20),u=n.n(l).a.create({baseURL:"https://vilgovskiy-kanban.herokuapp.com",headers:{"Content-Type":"application/json",Accept:"application/json"}}),b=n(6),j=function(e,t){switch(t.type){case"DRAG_UPDATE":return Object(i.a)(Object(i.a)({},e),{},{dragOverColumn:t.column});case"TASK_UPDATE":var n=Object.values(e.tasks).filter((function(e){return e.id===t.taskID}))[0];n.column=e.dragOverColumn;var a=Object(i.a)(Object(i.a)({},e.tasks),{},Object(b.a)({},n.id,n));return Object(i.a)(Object(i.a)({},e),{},{tasks:a});case"TASKS_FETCH_START":return Object(i.a)(Object(i.a)({},e),{},{loading:!0});case"TASKS_FETCH":return Object(i.a)(Object(i.a)({},e),{},{tasks:t.tasks,loading:!1});case"ADD_TASK":return Object(i.a)(Object(i.a)({},e),{},{tasks:Object(i.a)(Object(i.a)({},e.tasks),{},Object(b.a)({},t.newTask.id,t.newTask))});case"EDIT_TASK":var s=Object(i.a)({},e.tasks);return s[t.updatedTask.id]=t.updatedTask,Object(i.a)(Object(i.a)({},e),{},{tasks:s});case"DELETE_TASK":var r=Object(i.a)({},e.tasks);return delete r[t.task_id],Object(i.a)(Object(i.a)({},e),{},{tasks:r});default:return e}},O={loading:!1,dragOverColumn:-1,tasks:{0:{id:0,title:"task0",description:"Task 0",severity:0,column:1},1:{id:1,title:"task1",description:"Task 1",severity:0,column:0},2:{id:2,title:"task2",description:"Task 2",severity:0,column:1},3:{id:3,title:"task3",description:"Task 3",severity:0,column:3}}},m=r.a.createContext({tasksState:O,tasksDispatch:function(){return null}}),h=function(e){var t=e.children,n=Object(s.useReducer)(j,O),r=Object(d.a)(n,2),c=r[0],o=r[1];return Object(a.jsx)(m.Provider,{value:{tasksState:c,tasksDispatch:o},children:t})},p=(n(46),{title:"",description:"",severity:0}),v=function(e){var t=Object(s.useContext)(m).tasksDispatch,n=Object(s.useState)(p),r=Object(d.a)(n,2),c=r[0],o=r[1],l=Object(s.useState)(""),j=Object(d.a)(l,2),O=j[0],h=j[1];Object(s.useEffect)((function(){"CREATE"!==e.type&&e.task&&o({title:e.task.title,description:e.task.description,severity:e.task.severity})}),[e.type,e.task]);var v=function(e,t){var n="severity"===t?+e.target.value:e.target.value,a=Object(i.a)(Object(i.a)({},c),{},Object(b.a)({},t,n));a.title.length>0&&""!==O&&h(""),o(a)};return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"Backdrop",onClick:e.formCloseHandler}),Object(a.jsx)("div",{className:"TaskFormWrapper",children:Object(a.jsxs)("div",{className:"TaskForm",children:["CREATE"===e.type?Object(a.jsx)("h3",{children:"Create new task"}):Object(a.jsx)("h3",{children:"Edit task"}),Object(a.jsx)("div",{className:"Errors",children:O}),Object(a.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},children:[Object(a.jsx)("div",{className:"TaskFormElement",id:"TaskTitle",children:Object(a.jsx)("input",{type:"text",placeholder:"Title",value:c.title,onChange:function(e){return v(e,"title")}})}),Object(a.jsx)("div",{className:"TaskFormElement",children:Object(a.jsx)("textarea",{placeholder:"Description",value:c.description,onChange:function(e){return v(e,"description")}})}),Object(a.jsxs)("div",{className:"TaskFormElement",children:[Object(a.jsx)("label",{children:"Severity"}),Object(a.jsxs)("select",{value:c.severity,onChange:function(e){return v(e,"severity")},children:[Object(a.jsx)("option",{value:0,children:"Low"},0),Object(a.jsx)("option",{value:1,children:"Medium"},1),Object(a.jsx)("option",{value:2,children:"High"},2),Object(a.jsx)("option",{value:3,children:"Extreme"},3)]})]}),Object(a.jsx)("button",{className:"General-btn Confirm-btn",onClick:"CREATE"===e.type?function(n){if(n.preventDefault(),c.title.length<1)h("Title must not be empty");else{var a={query:'mutation{add_task(title:"'.concat(c.title,'",description:"').concat(encodeURIComponent(c.description),'",severity:').concat(c.severity,",column:0,board:").concat(e.board_id,"){id,title,description,severity,column}}")};u.post("/api",a).then((function(e){var n=e.data;if(null!==n.data.add_task){var a=Object(i.a)(Object(i.a)({},n.data.add_task),{},{description:decodeURIComponent(n.data.add_task.description)});t({type:"ADD_TASK",newTask:a})}})).catch((function(e){return console.log(e)})),e.formCloseHandler()}}:function(n){var a;if(n.preventDefault(),c.title.length<1)h("Title must not be empty");else{var s={query:"mutation{update_task(id:".concat(null===(a=e.task)||void 0===a?void 0:a.id,',title:"').concat(c.title,'",description:"').concat(encodeURIComponent(c.description),'",severity:').concat(c.severity,"){id,title,description,severity,column}}")};u.post("/api",s).then((function(n){var a,s=n.data;if(null!==s.data.update_task&&s.data.update_task.id===(null===(a=e.task)||void 0===a?void 0:a.id)){var r=Object(i.a)(Object(i.a)({},s.data.update_task),{},{description:decodeURIComponent(s.data.update_task.description)});t({type:"EDIT_TASK",updatedTask:r})}else s.errors&&console.log(s.errors[0].message)})).catch((function(e){return console.log(e)})),e.formCloseHandler()}},children:"Accept"}),Object(a.jsx)("button",{className:"General-btn Cancel-btn",onClick:e.formCloseHandler,children:"Cancel"})]})]})})]})},f=(n(47),n(5)),x={0:" SevLow",1:" SevMedium",2:" SevHigh",3:" SevExtreme"},k=function(e){var t=Object(s.useState)(!1),n=Object(d.a)(t,2),r=n[0],c=n[1],o=Object(s.useState)(!1),i=Object(d.a)(o,2),l=i[0],u=i[1],b=Object(a.jsx)("p",{children:e.task.description});e.task.description.length>60&&!r&&(b=Object(a.jsxs)("p",{className:"Expandable",children:[e.task.description.substring(0,60),Object(a.jsx)("span",{children:"..."})]}));var j=l?Object(a.jsx)(v,{type:"EDIT",task:e.task,formCloseHandler:function(){return u(!1)}}):null,O=x[e.task.severity];return Object(a.jsxs)("div",{className:"KanBanCard"+O,draggable:!0,onDragEnd:function(t){return e.onDragEnd(t,e.task.id)},children:[Object(a.jsxs)("div",{className:"CardTitle",children:[j,Object(a.jsx)("h4",{children:e.task.title}),Object(a.jsxs)("div",{className:"CardChangeIcons",children:[Object(a.jsx)("div",{className:"CardChangeIcon",onClick:function(){return u(!0)},children:Object(a.jsx)(f.d,{size:20})}),Object(a.jsx)("div",{className:"CardChangeIcon",onClick:function(){return e.onTaskDelete(e.task.id)},children:Object(a.jsx)(f.c,{size:20})})]})]}),e.task.description.length>0?Object(a.jsx)("div",{className:"CardDescription",onClick:function(){return c(!r)},children:b}):null]})},g=(n(48),function(e){return Object(a.jsxs)("div",{className:"KanBanColumn",onDragEnter:function(t){return e.onDragEnter(t,e.columnId)},children:[Object(a.jsx)("h3",{children:e.name}),Object(a.jsx)("div",{className:"TasksSection",children:e.tasks.map((function(t){return Object(a.jsx)(k,{task:t,onDragEnd:e.onDragEnd,onTaskDelete:e.onTaskDelete},t.id)}))})]})}),_=(n(49),n(9)),C=(n(50),function(e){var t=Object(s.useState)(""),n=Object(d.a)(t,2),c=n[0],o=n[1],i=Object(s.useState)([]),l=Object(d.a)(i,2),b=l[0],j=l[1],O=Object(s.useState)(null),m=Object(d.a)(O,2),h=m[0],p=m[1];Object(s.useEffect)((function(){u.get("/api?query={users_on_board(board_id: ".concat(e.board_id,"){id,name}}")).then((function(t){var n=t.data;null!=n.data.users_on_board?j(n.data.users_on_board.filter((function(t){return t.id!==e.user_id}))):n.errors&&p(n.errors[0].message)})).catch((function(e){console.log(e),p("Something went horribly wrong!")}))}),[e.board_id,e.user_id]);return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)("div",{className:"Backdrop",onClick:e.closeHandler}),Object(a.jsxs)("div",{className:"AccessControl",children:[Object(a.jsx)("h3",{children:"Access Control"}),Object(a.jsx)("div",{className:"CloseIcon",onClick:e.closeHandler,children:Object(a.jsx)(f.b,{size:30})}),h?Object(a.jsx)("div",{className:"Errors",children:h}):null,Object(a.jsxs)("div",{className:"GeneralInput",children:[Object(a.jsx)("label",{children:"Add user"}),Object(a.jsx)("input",{type:"text",value:c,placeholder:"Username(case sensitive)",onChange:function(e){e.preventDefault(),e.target.value.length>0&&p(null),o(e.target.value)}}),Object(a.jsx)("button",{onClick:function(){if(c.length<1)p("Username can not be empty");else{var t={query:"mutation{add_user_to_board(board:".concat(e.board_id,',user:"').concat(c,'"){id,name}}')};u.post("/api",t).then((function(e){var t=e.data;null!=t.data.add_user_to_board?(j([].concat(Object(_.a)(b),[t.data.add_user_to_board])),p(null)):t.errors&&p(t.errors[0].message)})).catch((function(e){console.log(e),p("Something went horribly wrong")}))}},children:Object(a.jsx)(f.f,{size:30})})]}),Object(a.jsx)("h5",{children:"Users have access to this board:"}),Object(a.jsx)("div",{className:"CurrentUsers",children:b.map((function(t){return Object(a.jsxs)("div",{className:"CurrentUser",children:[t.name,Object(a.jsx)("button",{onClick:function(){return function(t){var n={query:"mutation{remove_user_from_board(user_id:".concat(t,",board_id:").concat(e.board_id,"){id}}")};u.post("/api",n).then((function(e){var n=e.data;null!==n.data.remove_user_from_board&&n.data.remove_user_from_board.id===t?j(b.filter((function(e){return e.id!==t}))):n.errors&&p(n.errors[0].message)})).catch((function(e){console.log(e),p("Something went horribly wrong!")}))}(t.id)},children:Object(a.jsx)(f.g,{size:25})})]},t.id)}))})]})]})}),y=[{id:0,name:"Backlog"},{id:1,name:"Assigned"},{id:2,name:"In Progress"},{id:3,name:"QA"},{id:4,name:"Completed"}],T=function(e){var t=e.userID,n=e.board,c=e.boardDelete,o=Object(s.useContext)(m),i=o.tasksState,l=o.tasksDispatch,b=Object(s.useState)(!1),j=Object(d.a)(b,2),O=j[0],h=j[1],p=Object(s.useState)(!1),x=Object(d.a)(p,2),k=x[0],_=x[1],T=i.tasks,D=function(e,t){e.preventDefault(),l({type:"DRAG_UPDATE",column:t})},S=function(e,t){if(e.preventDefault(),i.tasks[t].column!==i.dragOverColumn){var n={query:"mutation {\n        move_task(task_id:".concat(t,", column:").concat(i.dragOverColumn,"){\n          id,\n          title,\n          description,\n          severity,\n          column\n        }\n      }")};u.post("/api",n).then((function(e){var n=e.data;null!==n.data.move_task&&n.data.move_task.id===t&&l({type:"TASK_UPDATE",taskID:t})})).catch((function(e){return console.log(e)}))}},E=function(e){var t={query:"mutation{delete_task(id:".concat(e,"){id}}")};u.post("/api",t).then((function(t){var n=t.data;null!=n.data.delete_task&&n.data.delete_task.id===e?l({type:"DELETE_TASK",task_id:e}):n.errors&&console.log(n.errors)})).catch((function(e){return console.log(e)}))},N=O?Object(a.jsx)(v,{type:"CREATE",board_id:n.id,formCloseHandler:function(){return h(!1)}}):null,w=k?Object(a.jsx)(C,{user_id:t,board_id:n.id,closeHandler:function(){return _(!1)}}):null,I=Object(a.jsxs)("div",{className:"BoardControls",children:[Object(a.jsx)("h1",{children:n.name}),Object(a.jsxs)("div",{className:"General-btn Confirm-btn AddTask",onClick:function(){return h(!0)},children:[Object(a.jsx)(f.a,{size:30})," Add Task"]}),n.isOwner?Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)("div",{className:"General-btn Cancel-btn DeleteIcon",onClick:function(){return c(n.id)},children:Object(a.jsx)(f.c,{size:30})}),Object(a.jsxs)("div",{className:"General-btn Warning-btn AccessControlButton",onClick:function(){return _(!0)},children:[Object(a.jsx)(f.e,{size:30})," Access control"]})]}):null,N,w]});return Object(a.jsxs)("div",{className:"KanBanBoard",children:[I,Object(a.jsx)("div",{className:"Columns",children:y.map((function(e){return Object(a.jsx)(g,{name:e.name,columnId:e.id,tasks:Object.values(T).filter((function(t){return t.column===e.id})),onDragEnter:D,onDragEnd:S,onTaskDelete:E},e.id)}))})]})},D=r.a.memo(T,(function(e,t){return e.board.id===t.board.id})),S={loaded:!1,id:-1},E={loggedIn:!1,username:"",userID:null,boards:[],activeBoard:S},N=function(e,t){switch(t.type){case"LOG_IN":var n=t.user.boards.map((function(e){return{id:e.id,name:e.name,isOwner:e.owner.id===t.user.id}}));return Object(i.a)(Object(i.a)({},e),{},{loggedIn:!0,userID:t.user.id,username:t.user.name,boards:n});case"LOG_OUT":return E;case"ADD_BOARD":var a=[].concat(Object(_.a)(e.boards),[t.board]);return Object(i.a)(Object(i.a)({},e),{},{boards:a,activeBoard:{loaded:!0,id:a.length-1}});case"DELETE_BOARD":var s=e.boards.filter((function(e){return e.id!==t.board_id}));return Object(i.a)(Object(i.a)({},e),{},{boards:s,activeBoard:S});case"SET_ACTIVE_BOARD":return Object(i.a)(Object(i.a)({},e),{},{activeBoard:{loaded:!0,id:t.id}});default:return e}},w={loggedIn:!1,username:"",userID:null,boards:[],activeBoard:{loaded:!1,id:-1}},I=r.a.createContext({userState:w,userDispatch:function(){return null}}),A=function(e){var t=e.children,n=Object(s.useReducer)(N,w),r=Object(d.a)(n,2),c=r[0],o=r[1];return Object(a.jsx)(I.Provider,{value:{userState:c,userDispatch:o},children:t})},B=(n(51),function(e){var t=Object(s.useState)(e.boards.length>0?e.boards[0].id:-1),n=Object(d.a)(t,2),r=n[0],c=n[1];Object(s.useEffect)((function(){void 0===e.boards.find((function(e){return e.id===r}))&&c(e.boards.length>0?e.boards[0].id:-1)}),[e.boards,r]);var o=Object(s.useState)(""),i=Object(d.a)(o,2),l=i[0],u=i[1],b=Object(a.jsxs)("div",{className:"GeneralInput",children:[Object(a.jsx)("label",{children:"Create a board"}),Object(a.jsx)("input",{type:"text",value:l,placeholder:"New board name",onChange:function(e){u(e.target.value)}}),Object(a.jsx)("button",{onClick:function(){return e.createHandler(l)},children:Object(a.jsx)(f.a,{size:30})})]}),j=e.boards.length>0?Object(a.jsxs)("div",{className:"BoardSelection",children:[Object(a.jsx)("label",{children:"Or select existing:"}),Object(a.jsx)("select",{id:"BoardSelection",onChange:function(e){c(+e.target.value)},children:e.boards.map((function(e){return Object(a.jsx)("option",{value:e.id,children:e.name},e.id)}))}),Object(a.jsx)("button",{id:"LoadBoardButton",onClick:function(){return e.loadHandler(r)},children:"Load"})]}):null;return Object(a.jsxs)("div",{className:"Toolbar",children:[Object(a.jsxs)("div",{className:"ToolbarControls",children:[b,j]}),Object(a.jsxs)("h3",{children:["Hello"," ",Object(a.jsxs)("span",{style:{fontSize:5/e.user.length+"em"},children:[e.user,"!"]})]}),Object(a.jsx)("button",{className:"LogOutButton",onClick:e.logOutHandler,children:"Log out"})]})}),L=function(){var e=Object(s.useContext)(I),t=e.userState,n=e.userDispatch,r=Object(s.useContext)(m).tasksDispatch;Object(s.useEffect)((function(){t.activeBoard.loaded&&(r({type:"TASKS_FETCH_START"}),u.get("/api?query={tasks_on_board(board_id:".concat(t.boards[t.activeBoard.id].id,"){id,title,description,severity,column}}")).then((function(e){var t=e.data;if(null!=t.data.tasks_on_board){for(var n={},a=0;a<t.data.tasks_on_board.length;a++){var s=Object(i.a)(Object(i.a)({},t.data.tasks_on_board[a]),{},{description:decodeURIComponent(t.data.tasks_on_board[a].description)});n[s.id]=s}r({type:"TASKS_FETCH",tasks:n})}})))}),[t.activeBoard.id,t.activeBoard.loaded,t.boards,r]);var c=t.activeBoard.loaded&&null!==t.boards?Object(a.jsx)(D,{userID:t.userID,board:t.boards[t.activeBoard.id],boardDelete:function(e){var t={query:"mutation{delete_board(id:".concat(e,"){id}}")};u.post("/api",t).then((function(t){t.data.errors||n({type:"DELETE_BOARD",board_id:e})})).catch((function(e){return console.log(e)}))}}):null;return Object(a.jsxs)("div",{children:[Object(a.jsx)(B,{user:t.username,boards:t.boards,createHandler:function(e){if(t.loggedIn){var a={query:'mutation{add_board(name:"'.concat(e,'",owner:').concat(t.userID,"){id,name}}")};u.post("/api",a).then((function(e){var t=e.data;null!==t.data.add_board&&n({type:"ADD_BOARD",board:Object(i.a)(Object(i.a)({},t.data.add_board),{},{isOwner:!0})})})).catch((function(e){return console.log(e)}))}},loadHandler:function(e){if(null!=e&&e>0){var a=null!==t.boards?t.boards.findIndex((function(t){return t.id===e})):-1;n({type:"SET_ACTIVE_BOARD",id:a})}},logOutHandler:function(){n({type:"LOG_OUT"})}}),c]})},U=(n(52),function(){return Object(a.jsx)("div",{className:"Spinner",children:"Loading..."})}),H=(n(53),{username:"",password:""}),F=function(){var e=Object(s.useContext)(I).userDispatch,t=Object(s.useState)(H),n=Object(d.a)(t,2),r=n[0],c=n[1],o=Object(s.useState)(null),l=Object(d.a)(o,2),j=l[0],O=l[1],m=Object(s.useState)(null),h=Object(d.a)(m,2),p=h[0],v=h[1],f=Object(s.useState)(!1),x=Object(d.a)(f,2),k=x[0],g=x[1],_=function(e,t){var n=Object(i.a)(Object(i.a)({},r),{},Object(b.a)({},t,e.target.value));c(n)},C=function(e){var t={};return r.username.length<1&&(t.username="Username can not be empty"),r.username.includes(" ")&&(t.username="Username can not contain spaces"),"SIGNUP"===e&&r.password.length<6?t.password="Password must be at least 6 characters long.":r.password.length<1&&(t.password="Password can not be empty."),!(Object.keys(t).length>0)||(O(t),!1)};return Object(a.jsxs)("div",{className:"LogInForm",children:[Object(a.jsx)("h2",{children:"Hello User! "}),Object(a.jsx)("h3",{children:"Please sign in to view boards!"}),Object(a.jsx)("div",{className:"Errors",children:null!==j?Object.keys(j).map((function(e){return Object(a.jsx)("p",{children:j[e]},e)})):null}),Object(a.jsx)("div",{className:"LogInMessages",children:null!==p?Object(a.jsx)("p",{children:p}):null}),k?Object(a.jsx)(U,{}):null,Object(a.jsxs)("form",{children:[Object(a.jsxs)("div",{className:"LogInFormGroup",children:[Object(a.jsx)("input",{className:j&&j.username?"NeedFixing":"",type:"text",id:"username",placeholder:"Username",value:r.username,onChange:function(e){return _(e,"username")},required:!0}),Object(a.jsx)("label",{htmlFor:"username",children:"Username"})]}),Object(a.jsxs)("div",{className:"LogInFormGroup",children:[Object(a.jsx)("input",{className:j&&j.password?"NeedFixing":"",type:"password",id:"password",placeholder:"Password",value:r.password,onChange:function(e){return _(e,"password")},required:!0}),Object(a.jsx)("label",{htmlFor:"password",children:"Password"})]}),Object(a.jsx)("button",{onClick:function(t){t.preventDefault(),C("LOGIN")&&(g(!0),u.get('/api?query={auth(name:"'.concat(r.username,'",password:"').concat(r.password,'"){id,name,boards{id,name,,owner{id}}}}')).then((function(t){var n=t.data;if(null!==n.data.auth)e({type:"LOG_IN",user:n.data.auth});else{v(null);var a="Could not log in, please check you username/password";n.errors&&(a=n.errors.join("; ")),O({LOGIN:a}),g(!1)}})).catch((function(e){console.log(e),O({LOGIN:"Opps something went terribly wrong!"}),g(!1)})))},children:"Log in"}),Object(a.jsx)("button",{onClick:function(e){if(e.preventDefault(),C("SIGNUP")){g(!0);var t={query:'mutation{add_user(name:"'.concat(r.username,'",password:"').concat(r.password,'"){id,name}}')};u.post("/api",t).then((function(e){var t=e.data;if(null!==t.data.add_user)O(null),v("Successfully created user ".concat(t.data.add_user.name,". Now you can log in with this username: "));else if(t.errors){var n="";t.errors[0].message.includes("duplicate key value")&&(n=": User with such name already exists"),O({SIGNUP:"Could not create user ".concat(r.username).concat(n)}),v(null)}g(!1)})).catch((function(e){console.log(e),g(!1)}))}},children:"Sign up"})]})]})},R=function(){var e=Object(s.useContext)(I).userState.loggedIn?Object(a.jsx)(L,{}):Object(a.jsx)(F,{});return Object(a.jsx)(h,{children:Object(a.jsx)("div",{className:"App",children:e})})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,55)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),r(e),c(e)}))};o.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(A,{children:Object(a.jsx)(R,{})})}),document.getElementById("root")),G()}},[[54,1,2]]]);
//# sourceMappingURL=main.8ba9d79e.chunk.js.map